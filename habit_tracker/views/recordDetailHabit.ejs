<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Record Detail Habit</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <style>
      #chartContainer {
        width: 300px;
        /* Đặt chiều rộng container */
        height: 300px;
        /* Đặt chiều cao container */
        margin: auto;
        /* Căn giữa container */
      }
  
      canvas {
        width: 100% !important;
        /* Đảm bảo canvas chiếm toàn bộ diện tích container */
        height: 100% !important;
        /* Đảm bảo canvas chiếm toàn bộ diện tích container */
      }
    </style>
</head>
<body>  <div id="chartContainer">
  <canvas id="habitChart"></canvas>
  <br>
</div>
  <table>
    <tr>
      <!-- <td><%= habit.name%></td><br>
      <td><%= habit.goalTarget%></td><br>
      <td><%= habit.unit%></td><br> -->
      <td>
        <%
         let totalProgress = 0;
         let numFinish = 0;
         habit.occurrences.forEach(occurrence =>{
         totalProgress += occurrence.progress;
         if(occurrence.status === 'finish'){
          numFinish++;
         }
           %>
          <!-- <div> <%= occurrence.progress %></div> -->
        <% }); %>
        
        <% 
        let lengthOccurences = habit.occurrences.length;
        %>
        
        <div>Total Target: <%= lengthOccurences * habit.goalTarget%></div>
        <div>Total Occurrences: <%= habit.occurrences.length %></div>
        <div>Total Progress : <%= totalProgress%></div>
          
      </td>
      
    </tr>
    <tr>
      <td>Number of Finishs:</td>
      <td><%= numFinish %></td>
    </tr>
  </table>
  <div id="data" data-total-finish="<%= totalProgress %>" data-total-habits=" <%= lengthOccurences 
    * habit.goalTarget
    %>"></div>
  <button onclick="window.location.href = '/v1/record'">Back to Home</button>
 <script>
      document.addEventListener('DOMContentLoaded', (event) => {
      const dataDiv = document.getElementById('data');
      const totalFinish = parseInt(dataDiv.getAttribute('data-total-finish'));
      const totalHabits = parseInt(dataDiv.getAttribute('data-total-habits'));
      const remainingHabits = totalHabits - totalFinish;

      const ctx = document.getElementById('habitChart').getContext('2d');

      const data = {
        labels: ['Thói quen hoàn thành', 'Thói quen chưa hoàn thành'],
        datasets: [{
          label: 'Hoàn Thành Thói Quen',
          data: [totalFinish, remainingHabits],
          backgroundColor: ['#36a2eb', '#ff6384'],
          hoverBackgroundColor: ['#36a2eb', '#ff6384']
        }]
      };

      const config = {
        type: 'pie',
        data: data,
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
            },
            title: {
              display: true,
              text: 'Biểu Đồ Hoàn Thành Thói Quen'
            },
            datalabels: {
              formatter: (value, context) => {

                return value;
              },
              color: '#fff',
            }
          }
        },
        plugins: [ChartDataLabels],
      };

      const habitChart = new Chart(ctx, config);
    });
 </script>
</body>
</html>
